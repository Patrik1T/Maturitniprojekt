  {% extends "struktura/basetests.html" %}

{% block title %}Pexeso: Otázky a Odpovědi{% endblock %}

{% block content %}

<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Quiz Bird</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
        }

        #gameCanvas {
            display: block;
            margin: 20px auto;
            background-color: #70C5CE;
            border: 2px solid black;
            width: 600px;
            height: 400px;
        }

        .button {
            padding: 10px 15px;
            border: none;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            display: block;
            margin: 20px auto;
        }

        #questionPopup {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        #questionText {
            margin-bottom: 20px;
        }

        #answerOptions button {
            margin: 5px;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        
        #questionManager {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

#questionManager input[type="text"] {
    width: calc(100% - 10px);
    margin-bottom: 10px;
    padding: 5px;
}

#answersContainer .answer {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}

    </style>
</head>
<body>

<h1>Flappy Quiz Bird</h1>

<div id="questionManager">
    
    <h2>Správa otázek</h2>
    
    
    <div>
        <label for="newQuestion">Otázka:</label>
        <input type="text" id="newQuestion">
    </div>
    <div id="answersContainer">
        <div class="answer">
            <input type="text" placeholder="Odpověď">
            <input type="checkbox"> Správná odpověď
            <button onclick="removeAnswer(this)">Odebrat</button>
        </div>
    </div>
    <button onclick="addAnswer()">Přidat odpověď</button>
    <button onclick="addQuestion()">Přidat otázku</button>
    <hr>
</div>


<button class="button" onclick="startGame()">Začít hru</button>

<canvas id="gameCanvas" width="600" height="400"></canvas>

<div id="questionPopup">
    <h2 id="questionText">Otázka se zobrazí zde</h2>
    <div id="answerOptions"></div>
    <button onclick="closeQuestion()">Zavřít otázku</button>
</div>

<script>
    let questions = [];
    let score = 0;
    let gameInterval;
    let pipes = [];
    const pipeWidth = 50;
    const pipeGap = 200;
    const bird = { x: 100, y: 150, width: 30, height: 30, gravity: 0.5, lift: -10, velocity: 0, alive: true };
    let currentQuestion;
    
    // Načtení otázek z Local Storage při spuštění hry
window.addEventListener("load", function() {
    const savedQuestions = localStorage.getItem("questions");
    if (savedQuestions) {
        questions = JSON.parse(savedQuestions);
        console.log("Načtené otázky:", questions);
    }
});


    // Funkce pro spuštění hry
    function startGame() {
        // Pokud hra již běží, nic neuděláme
        if (gameInterval) {
            return;
        }

        // Resetujeme skóre a trubky
        score = 0;
        pipes = [];
        bird.alive = true;
        bird.y = 150;
        bird.velocity = 0;

        // Inicializace herního intervalového cyklu
        gameInterval = setInterval(gameLoop, 1000 / 60);
    }

    // Funkce pro skákání ptáka
    function flap() {
        // Pták může skákat jen pokud není příliš vysoko (aby se zabránilo "double jumpům")
        if (bird.alive && bird.velocity >= 0) {
            bird.velocity = bird.lift; // Změníme rychlost ptáka na zápornou (skok)
        }
    }

    // Funkce pro obsluhu události stisknutí klávesy
    window.addEventListener('keydown', function(event) {
        if (event.code === 'Space') { // Když stiskneš mezerník
            flap();
        }
    });

    // Funkce pro obsluhu kliknutí myší
    window.addEventListener('click', function() {
        flap();
    });

    // Herní smyčka
    function gameLoop() {
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Nastavení gravitace a pohybu ptáčka
        bird.velocity += bird.gravity;
        bird.y += bird.velocity;

        // Kontrola kolize s dolní hranou obrazovky
        if (bird.y + bird.height >= canvas.height) {
            bird.y = canvas.height - bird.height;
            bird.velocity = 0;
        }

        // Pohyb trubek
        pipes.forEach(pipe => {
            pipe.x -= 2; // Rychlost pohybu trubek

            // Kontrola kolize s trubkami
            if (
                bird.x + bird.width > pipe.x &&
                bird.x < pipe.x + pipeWidth &&
                (bird.y < pipe.y || bird.y + bird.height > pipe.y + pipeGap)
            ) {
                endGame(); // Hra končí při kolizi
            }

            // Pokud pták proletí mezi trubkami, zobrazí se otázka
            if (bird.x + bird.width > pipe.x + pipeWidth && !pipe.passed) {
                pipe.passed = true;
                askQuestion(pipe); // Zobrazí se otázka
            }
        });

        // Vytvoření nové trubky, pokud je potřeba
        if (pipes.length === 0 || pipes[pipes.length - 1].x < canvas.width - 150) {
            createPipe();
        }

        // Kreslení ptáčka a trubek
        drawBird();
        drawPipes();

        // Zobrazení skóre
        ctx.fillStyle = "#000";
        ctx.font = "20px Arial";
        ctx.fillText(`Skóre: ${score}`, 20, 30);
    }

    // Funkce pro vytvoření nové trubky
    function createPipe() {
        const canvas = document.getElementById("gameCanvas");
        const height = Math.floor(Math.random() * (canvas.height - pipeGap - 60)) + 30;
        pipes.push({ x: canvas.width, y: height, passed: false });
    }

    // Funkce pro zobrazení ptáčka
    function drawBird() {
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        ctx.fillStyle = "#FFD700"; // Barva ptáčka
        ctx.fillRect(bird.x, bird.y, bird.width, bird.height);
    }

    // Funkce pro vykreslení trubek
    function drawPipes() {
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        ctx.fillStyle = "#228B22"; // Barva trubek

        pipes.forEach(pipe => {
            ctx.fillRect(pipe.x, 0, pipeWidth, pipe.y); // Horní trubka
            ctx.fillRect(pipe.x, pipe.y + pipeGap, pipeWidth, canvas.height - pipe.y - pipeGap); // Spodní trubka
        });
    }
    
    function addAnswer() {
    const container = document.getElementById("answersContainer");
    const answerDiv = document.createElement("div");
    answerDiv.classList.add("answer");

    answerDiv.innerHTML = `
        <input type="text" placeholder="Odpověď">
        <input type="checkbox"> Správná odpověď
        <button onclick="removeAnswer(this)">Odebrat</button>
    `;
    container.appendChild(answerDiv);
}

function removeQuestion(index) {
    if (confirm("Opravdu chcete tuto otázku odstranit?")) {
        questions.splice(index, 1); // Odebrání otázky na základě indexu
        updateLocalStorage(); // Aktualizace Local Storage
        alert("Otázka byla odstraněna.");
    }
}


function removeAnswer(button) {
    const answerDiv = button.parentElement;
    answerDiv.remove();
}
function askQuestion(pipe) {
    clearInterval(gameInterval);

    // Vybereme náhodnou otázku
    currentQuestion = getRandomQuestion();

    // Debugovací výpis
    console.log("Zobrazená otázka:", currentQuestion);

    // Zobrazíme popup s otázkou
    const questionPopup = document.getElementById("questionPopup");
    const questionText = document.getElementById("questionText");
    const answerOptions = document.getElementById("answerOptions");

    if (!currentQuestion) {
        console.error("Žádné otázky nejsou dostupné.");
        return;
    }

    questionText.textContent = currentQuestion.question;
    answerOptions.innerHTML = ""; // Vyčistíme předchozí odpovědi

    currentQuestion.answers.forEach(answer => {
        const button = document.createElement("button");
        button.textContent = answer.text;
        button.onclick = () => {
            if (answer.correct) {
                score += 10; // Přičteme body za správnou odpověď
            }
            closeQuestion(); // Zavřeme otázku
        };
        answerOptions.appendChild(button);
    });

    questionPopup.style.display = "block";
}


   function addQuestion() {
    const questionInput = document.getElementById("newQuestion");
    const answersContainer = document.getElementById("answersContainer");
    const questionText = questionInput.value.trim();

    if (!questionText) {
        alert("Zadejte text otázky.");
        return;
    }

    const answers = [];
    answersContainer.querySelectorAll(".answer").forEach(answerDiv => {
        const answerText = answerDiv.querySelector("input[type='text']").value.trim();
        const isCorrect = answerDiv.querySelector("input[type='checkbox']").checked;

        if (answerText) {
            answers.push({ text: answerText, correct: isCorrect });
        }
    });

    if (answers.length === 0) {
        alert("Přidejte alespoň jednu odpověď.");
        return;
    }

    // Přidáme otázku do pole a aktualizujeme Local Storage
    questions.push({ question: questionText, answers });
    updateLocalStorage();

    // Reset formuláře
    questionInput.value = "";
    answersContainer.innerHTML = `
        <div class="answer">
            <input type="text" placeholder="Odpověď">
            <input type="checkbox"> Správná odpověď
            <button onclick="removeAnswer(this)">Odebrat</button>
        </div>
    `;
    alert("Otázka byla přidána.");
}





    // Funkce pro uzavření otázky
    function closeQuestion() {
        const questionPopup = document.getElementById("questionPopup");
        questionPopup.style.display = "none"; // Skryjeme popup
        gameInterval = setInterval(gameLoop, 1000 / 60); // Obnovíme herní smyčku
    }

    // Funkce pro výběr náhodné otázky
    function getRandomQuestion() {
        return questions[Math.floor(Math.random() * questions.length)];
    }

    function endGame() {
    bird.alive = false;
    clearInterval(gameInterval);

    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Zobrazíme zprávu o skončení hry
    ctx.fillStyle = "rgba(0, 0, 0, 0.7)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#FFF";
    ctx.font = "36px Arial";
    ctx.textAlign = "center";
    ctx.fillText("Hra skončila!", canvas.width / 2, canvas.height / 2 - 20);
    ctx.fillText(`Skóre: ${score}`, canvas.width / 2, canvas.height / 2 + 20);

    // Přidáme tlačítko pro restart
    const restartButton = document.createElement("button");
    restartButton.textContent = "Restartovat hru";
    restartButton.classList.add("button");
    restartButton.onclick = restartGame;
    document.body.appendChild(restartButton);
}

function restartGame() {
    // Reset ptáka, trubek a skóre
    bird.alive = true;
    bird.y = 150;
    bird.velocity = 0;
    score = 0;
    pipes = [];

    // Odstraníme tlačítko pro restart
    document.querySelector(".button").remove();

    // Spustíme hru znovu
    gameInterval = setInterval(gameLoop, 1000 / 60);
}

function clearQuestions() {
    localStorage.removeItem("questions");
    questions = [];
    alert("Všechny otázky byly smazány.");
}

function updateLocalStorage() {
    localStorage.setItem("questions", JSON.stringify(questions));
}

</script>

</body>
</html>
{% endblock %}
